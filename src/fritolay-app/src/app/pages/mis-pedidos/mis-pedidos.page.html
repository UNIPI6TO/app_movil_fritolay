<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/catalogo"></ion-back-button>
    </ion-buttons>
    <ion-title>Mis pedidos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-refresher slot="fixed" (ionRefresh)="cargarPedidos()">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Mensaje de Error -->
  <div *ngIf="error" class="error-message ion-margin">
    <ion-icon name="alert-circle"></ion-icon>
    <span>{{error}}</span>
  </div>

  <!-- Listado de Pedidos -->
  <div *ngIf="!loading && pedidos.length > 0" class="pedidos-container">
    <ion-card *ngFor="let p of pedidos" 
              (click)="abrirDetallePedido(p)" 
              class="pedido-card">
      <ion-card-header>
        <ion-card-title>
          <div class="pedido-header">
            <span class="pedido-numero">Pedido #{{p.idPedido}}</span>
            <ion-badge [color]="getEstadoColor(p.estado)">{{p.estado}}</ion-badge>
          </div>
        </ion-card-title>
        <ion-card-subtitle>{{p.fechaCreacion | date:'dd/MM/yyyy HH:mm'}}</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <!-- Resumen de Precio -->
        <div class="precio-section">
          <span class="label">Total:</span>
          <span class="total-price">{{p.totalPagar | currency}}</span>
        </div>

        <div class="divider"></div>

        <!-- Método de Pago y Cantidad de Items -->
        <div class="pedido-info">
          <div class="info-item">
            <span class="label">Método Pago:</span>
            <span>{{p.metodoPago}}</span>
          </div>
          <div class="info-item">
            <span class="label">Items:</span>
            <span>{{p.cantidadItems}}</span>
          </div>
        </div>

        <div class="divider" *ngIf="p.resumenProductos && p.resumenProductos.length > 0"></div>

        <!-- Resumen de Productos (máximo 2) -->
        <div *ngIf="p.resumenProductos && p.resumenProductos.length > 0" class="productos-resumen">
          <div *ngFor="let rp of p.resumenProductos.slice(0, 2)" class="producto-resumen-item">
            <span class="producto-nombre">{{rp.nombre}}</span>
            <span class="producto-cantidad">x{{rp.cantidad}}</span>
            <span class="producto-precio">{{rp.totalLinea | currency}}</span>
          </div>
          <div *ngIf="p.resumenProductos.length > 2" class="mas-productos">
            +{{p.resumenProductos.length - 2}} productos más...
          </div>
        </div>

        <!-- Indicador de Detalle -->
        <div class="click-indicator">
          <span>Toca para ver detalles</span>
          <ion-icon name="chevron-forward"></ion-icon>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Sin Pedidos -->
  <div *ngIf="!loading && pedidos.length === 0" class="empty-state ion-text-center ion-margin">
    <ion-icon name="document-outline" size="large"></ion-icon>
    <h2>No hay pedidos</h2>
    <p>Aún no has realizado ningún pedido</p>
  </div>

  <!-- Cargando -->
  <div *ngIf="loading" class="loading-container ion-text-center ion-margin">
    <ion-spinner></ion-spinner>
    <p>Cargando pedidos...</p>
  </div>
</ion-content>
